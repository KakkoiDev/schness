<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Schness</title>
    <link rel="icon" href="/public/king-white.svg" />
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <script type="module">
      import van from "https://cdn.jsdelivr.net/gh/vanjs-org/van/public/van-1.5.0.min.js";
      import { handlePickup, handleMove, handleDrop } from "/lib/index.js";

      const movingPiece = van.state(null);

      document.addEventListener("mousemove", (event) =>
        handleMove({ event, movingPiece })
      );
      document.addEventListener("touchmove", (event) =>
        handleMove({ event, movingPiece })
      );
      document.addEventListener("mouseup", (event) =>
        handleDrop({ event, movingPiece })
      );
      document.addEventListener("touchend", (event) =>
        handleDrop({ event, movingPiece })
      );

      const pieces = ["king", "rook", "bishop", "knight"];
      const squares = [
        "white",
        "black",
        "white",
        "black",
        "black",
        "white",
        "black",
        "white",
        "white",
        "black",
        "white",
        "black",
        "black",
        "white",
        "black",
        "white",
      ];

      const { div, img } = van.tags;

      const piece = (props) =>
        img({
          src: props.src,
          ontouchstart: (event) => handlePickup({ event, movingPiece }),
          onmousedown: (event) => handlePickup({ event, movingPiece }),
          className: "piece",
        });

      const bank = ({ color }) =>
        div(
          { className: "bank" },
          pieces.map((p) =>
            div(
              { className: "square" },
              piece({ src: `/public/${p}-${color}.svg` })
            )
          )
        );

      const square = (props) =>
        div({
          className: `square ${props.color === "white" ? "white" : "black"}`,
          ontouchend: (event) => handleDrop({ event, movingPiece }),
          onmouseup: (event) => handleDrop({ event, movingPiece }),
        });

      const board = div(
        {
          className: "board",
        },
        squares.map((color) => square({ color }))
      );

      const game = div(
        bank({ color: "black" }),
        board,
        bank({ color: "white" })
      );

      van.add(document.body, game);
    </script>
  </body>
</html>
